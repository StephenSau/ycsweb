!function(t){"use strict";t(["dummy","jquery","info","placeholder"],function(t,e,a){function s(t,a){this.$element=t,this.options=e.extend({},s.DEFAULTS,a),this.packageList()}return s.DEFAULTS={effective:["10001","10002","10005"]},s.prototype={telphoneReg:/(^1(3[0-9]|4[0-9]|5[0-35-9]|7[0-9]|8[0-9])\d{8}$)|(^(\d{0,4}\-)?\d{8}$)/,callParams:{},init:function(){},packageList:function(){var e=0,a=0,s=this.options.effective.length,i=t.experts.length,n=[],l=null,o=[];for(e=0;s>e;e+=1)for(a=0;i>a;a+=1)this.options.effective[e]===t.experts[a].id&&n.push(t.experts[a]);for(this.$element.empty(),e=0,s=n.length;s>e;e+=1)l=n[e],o.push("<li>"),o.push("<h4>"),o.push('<a href="javascript:;" data-role="detialBtn" data-value="'+l.id+'">'+l.name+"</a>"),o.push("</h4>"),o.push("<p>"),o.push("<span>"),o.push('<a href="javascript:;" data-role="detialBtn" data-value="'+l.id+'">'),o.push('<img src="'+l.thumbImage+'" width="86" height="110" />'),o.push("</a>"),o.push('<a href="javascript:;" class="btn btn_info" data-role="dialBtn" data-value="'+l.id+'">立即咨询</a>'),o.push("</span>"),o.push(l.intro),o.push("</p>"),o.push("</li>");this.$element.append(o.join("")),this.addBtnAction()},addBtnAction:function(){var t=this;this.$element.on("click",'[data-role="detialBtn"]',function(){t.showDetailBox(this.getAttribute("data-value"))}).on("click",'[data-role="dialBtn"]',function(){a.close(),t.showDialBox(this.getAttribute("data-value"))})},showDetailBox:function(s){var i=this,n=0,l=t.experts.length,o=null,h=[];for(n=0;l>n;n+=1)s===t.experts[n].id&&(o=t.experts[n]);h.push('<div class="export_detail_box" id="export_detail_box">'),h.push('<div class="edb_leftside">'),h.push('<img src="'+o.image+'" width="230" height="295" />'),h.push('<a href="javascript:;" id="edb_dialBtn"  data-value="'+o.id+'" class="btn btn_info">立即咨询</a>'),h.push("</div>"),h.push('<div class="edb_rightside">'),h.push("<h4>"+o.name+"</h4>"),h.push("<p>"+o.intro+"</p>"),h.push("</div>"),h.push("</div>"),a.show({content:h.join("")}),e("#edb_dialBtn").on("click",function(){a.close(),i.showDialBox()})},showDialBox:function(s){var i=this,n=0,l=null,o=t.experts.length,h="",d=[];for(n=0;o>n;n+=1)s===t.experts[n].id&&(h=t.experts[n].phone);d.push('<div class="phone_box" id="dial_box">'),d.push('<p class="mb_btnline">'),d.push('<input type="tel" class="mb_text" name="phone" id="dial_phone" placeholder="请输入您的手机或固话号码" maxlength="15">'),d.push('<a href="javascript:;" id="dial_btn" class="btn btn_warning">立即免费通话</a>'),d.push("<p>壹财税将免费拨打您与服务商电话，请稍后接听4008-310-866，并耐心等待服务商接听</p>"),d.push("</div>"),a.show({content:d.join("")}),l=e("#dial_phone"),l.placeholder().on("keyup",function(t){var e=t.keyCode;i.telphoneReg.test(this.value)?(l.addClass("valid"),l.removeClass("invalid"),13===e&&(a.close(),i.dialPhone(h,this.value))):(l.addClass("invalid"),l.removeClass("valid"))}),e("#dial_btn").on("click",function(){i.telphoneReg.test(l.val())?(a.close(),i.dialPhone(h,l.val())):l.addClass("invalid")})},dialPhone:function(t,a){var s=this,i={masterCallPhoneNo:a,slaveCallPhoneNo:t};e.ajax({url:"/common/requestBinCall4Specialist.htm",data:i,dataType:"json",type:"POST",xhrFields:{withCredentials:!0},success:function(t){"200"===t.status&&(s.callParams=t.re,s.showOnCallBox(),s.queryCallStatus())},error:function(t){}})},queryCallStatus:function(){var t=this,s=function(){e.ajax({url:"/common/qryBinCallStatus.htm",data:t.callParams,dataType:"json",type:"POST",xhrFields:{withCredentials:!0},success:function(t){"200"===t.status&&"0"===t.re.isCallFinish?setTimeout(s,5e3):a.close()},error:function(t){}})};s()},showOnCallBox:function(){var t=[];t.push('<p class="onCall_box">'),t.push('<i class="icon"></i> '),t.push("电话接通中……"),t.push("</p>"),a.show({content:t.join("")})}},s})}(window.define);